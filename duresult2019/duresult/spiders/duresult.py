import scrapy
from scrapy.selector import Selector
import os
import csv


class DuResultSpider(scrapy.Spider):
    name = "duresult"
    allowed_domains = ['duresult.in']
    if not os.path.isdir('pages'):
        os.mkdir('pages')
    PATH = 'pages/'

    # start_urls = []
    # df_links = pd.read_csv('../ml-latest-small/links.csv')
    # df_ratings = pd.read_csv('../ml-latest-small/ratings.csv')
    # df_ratings['add'] = 1
    # df_movie_grouped = pd.DataFrame(df_ratings.groupby('movieId').sum().sort_values('add', ascending=False)[['add', 'rating']])
    # df_movie_grouped['rating'] = df_movie_grouped['rating']/df_movie_grouped['add']
    # df_movie_sample_500 = pd.merge(df_movie_grouped, df_links, on='movieId', how='left')
    # df_movie_sample_500['imdbId'] = df_movie_sample_500['imdbId'].apply(lambda x: make_str(x))
    # for link in df_movie_sample_500.imdbId:
    #     start_urls.append('https://imdb.com/title/tt' + link)

    # start_urls = ['https://imdb.com/title/tt0109830', 'https://imdb.com/title/tt0111161', 'https://imdb.com/title/tt0110912', 'https://imdb.com/title/tt0102926', 'https://imdb.com/title/tt0133093', 'https://imdb.com/title/tt0076759', 'https://imdb.com/title/tt0107290', 'https://imdb.com/title/tt0112573', 'https://imdb.com/title/tt0103064', 'https://imdb.com/title/tt0108052', 'https://imdb.com/title/tt0137523', 'https://imdb.com/title/tt0114709', 'https://imdb.com/title/tt0080684', 'https://imdb.com/title/tt0114814', 'https://imdb.com/title/tt0169547', 'https://imdb.com/title/tt0114369', 'https://imdb.com/title/tt0116629', 'https://imdb.com/title/tt0112384', 'https://imdb.com/title/tt0082971', 'https://imdb.com/title/tt0120737', 'https://imdb.com/title/tt0086190', 'https://imdb.com/title/tt0068646', 'https://imdb.com/title/tt0106977', 'https://imdb.com/title/tt0096895', 'https://imdb.com/title/tt0167261', 'https://imdb.com/title/tt0120815', 'https://imdb.com/title/tt0167260', 'https://imdb.com/title/tt0103639', 'https://imdb.com/title/tt0116282', 'https://imdb.com/title/tt0167404', 'https://imdb.com/title/tt0111503', 'https://imdb.com/title/tt0114746', 'https://imdb.com/title/tt0110357', 'https://imdb.com/title/tt0088763', 'https://imdb.com/title/tt0111257', 'https://imdb.com/title/tt0172495', 'https://imdb.com/title/tt0126029', 'https://imdb.com/title/tt0119654', 'https://imdb.com/title/tt0099348', 'https://imdb.com/title/tt0117060', 'https://imdb.com/title/tt0109040', 'https://imdb.com/title/tt0209144', 'https://imdb.com/title/tt0110475', 'https://imdb.com/title/tt0468569', 'https://imdb.com/title/tt0325980', 'https://imdb.com/title/tt0078748', 'https://imdb.com/title/tt0101414', 'https://imdb.com/title/tt0095016', 'https://imdb.com/title/tt0112864', 'https://imdb.com/title/tt0107614', 'https://imdb.com/title/tt0107048', 'https://imdb.com/title/tt1375666', 'https://imdb.com/title/tt0093779', 'https://imdb.com/title/tt0266543', 'https://imdb.com/title/tt0119217', 'https://imdb.com/title/tt0111282', 'https://imdb.com/title/tt0120915', 'https://imdb.com/title/tt0097576', 'https://imdb.com/title/tt0120338', 'https://imdb.com/title/tt0112462', 'https://imdb.com/title/tt0071853', 'https://imdb.com/title/tt0100405', 'https://imdb.com/title/tt0110413', 'https://imdb.com/title/tt0073486', 'https://imdb.com/title/tt0120903', 'https://imdb.com/title/tt0109686', 'https://imdb.com/title/tt0198781', 'https://imdb.com/title/tt0113189', 'https://imdb.com/title/tt0105236', 'https://imdb.com/title/tt0338013', 'https://imdb.com/title/tt0266697', 'https://imdb.com/title/tt0088247', 'https://imdb.com/title/tt0071562', 'https://imdb.com/title/tt0120586', 'https://imdb.com/title/tt0112431', 'https://imdb.com/title/tt0090605', 'https://imdb.com/title/tt0099685', 'https://imdb.com/title/tt0120382', 'https://imdb.com/title/tt0317705', 'https://imdb.com/title/tt0083658', 'https://imdb.com/title/tt0268978', 'https://imdb.com/title/tt0117998', 'https://imdb.com/title/tt0145487', 'https://imdb.com/title/tt0083866', 'https://imdb.com/title/tt0145660', 'https://imdb.com/title/tt0117500', 'https://imdb.com/title/tt0087332', 'https://imdb.com/title/tt0066921', 'https://imdb.com/title/tt0211915', 'https://imdb.com/title/tt0181689', 'https://imdb.com/title/tt0067992', 'https://imdb.com/title/tt0240772', 'https://imdb.com/title/tt0099785', 'https://imdb.com/title/tt0372784', 'https://imdb.com/title/tt0119116', 'https://imdb.com/title/tt0114898', 'https://imdb.com/title/tt0099653', 'https://imdb.com/title/tt0264464', 'https://imdb.com/title/tt0088847', 'https://imdb.com/title/tt0113957', 'https://imdb.com/title/tt0258463', 'https://imdb.com/title/tt0120689', 'https://imdb.com/title/tt0190332', 'https://imdb.com/title/tt0109444', 'https://imdb.com/title/tt0113497', 'https://imdb.com/title/tt0378194', 'https://imdb.com/title/tt0091042', 'https://imdb.com/title/tt0081505', 'https://imdb.com/title/tt0062622', 'https://imdb.com/title/tt0246578', 'https://imdb.com/title/tt0110148', 'https://imdb.com/title/tt0087469', 'https://imdb.com/title/tt0111280', 'https://imdb.com/title/tt0078788', 'https://imdb.com/title/tt0241527', 'https://imdb.com/title/tt0407887', 'https://imdb.com/title/tt0108160', 'https://imdb.com/title/tt0118715', 'https://imdb.com/title/tt0129387', 'https://imdb.com/title/tt1049413', 'https://imdb.com/title/tt0109445', 'https://imdb.com/title/tt0910970', 'https://imdb.com/title/tt0112697', 'https://imdb.com/title/tt0075314', 'https://imdb.com/title/tt0163651', 'https://imdb.com/title/tt0109831', 'https://imdb.com/title/tt0112740', 'https://imdb.com/title/tt0113277', 'https://imdb.com/title/tt0117951', 'https://imdb.com/title/tt0295297', 'https://imdb.com/title/tt0093058', 'https://imdb.com/title/tt0114069', 'https://imdb.com/title/tt0106582', 'https://imdb.com/title/tt0106918', 'https://imdb.com/title/tt0118655', 'https://imdb.com/title/tt0434409', 'https://imdb.com/title/tt0034583', 'https://imdb.com/title/tt0162222', 'https://imdb.com/title/tt0116483', 'https://imdb.com/title/tt0120601', 'https://imdb.com/title/tt0114924', 'https://imdb.com/title/tt0499549', 'https://imdb.com/title/tt0120363', 'https://imdb.com/title/tt0057012', 'https://imdb.com/title/tt0096438', 'https://imdb.com/title/tt0119488', 'https://imdb.com/title/tt0180093', 'https://imdb.com/title/tt0119822', 'https://imdb.com/title/tt0234215', 'https://imdb.com/title/tt0095953', 'https://imdb.com/title/tt0371746', 'https://imdb.com/title/tt0190590', 'https://imdb.com/title/tt0151804', 'https://imdb.com/title/tt0208092', 'https://imdb.com/title/tt0304141', 'https://imdb.com/title/tt0107688', 'https://imdb.com/title/tt0032138', 'https://imdb.com/title/tt0110632', 'https://imdb.com/title/tt0138097', 'https://imdb.com/title/tt0121765', 'https://imdb.com/title/tt0298148', 'https://imdb.com/title/tt0120623', 'https://imdb.com/title/tt0120591', 'https://imdb.com/title/tt0092005', 'https://imdb.com/title/tt0073195', 'https://imdb.com/title/tt0212338', 'https://imdb.com/title/tt0117731', 'https://imdb.com/title/tt0094737', 'https://imdb.com/title/tt0094721', 'https://imdb.com/title/tt0482571', 'https://imdb.com/title/tt0099810', 'https://imdb.com/title/tt0113161', 'https://imdb.com/title/tt0079470', 'https://imdb.com/title/tt0099088', 'https://imdb.com/title/tt0100802', 'https://imdb.com/title/tt0112281', 'https://imdb.com/title/tt0361748', 'https://imdb.com/title/tt0118799', 'https://imdb.com/title/tt0080339', 'https://imdb.com/title/tt0096874', 'https://imdb.com/title/tt0245429', 'https://imdb.com/title/tt0120616', 'https://imdb.com/title/tt0116996', 'https://imdb.com/title/tt0119177', 'https://imdb.com/title/tt0097165', 'https://imdb.com/title/tt0115685', 'https://imdb.com/title/tt0116695', 'https://imdb.com/title/tt0098635', 'https://imdb.com/title/tt0268380', 'https://imdb.com/title/tt0401792', 'https://imdb.com/title/tt0047396', 'https://imdb.com/title/tt0080455', 'https://imdb.com/title/tt0106220', 'https://imdb.com/title/tt0115759', 'https://imdb.com/title/tt0054215', 'https://imdb.com/title/tt0181875', 'https://imdb.com/title/tt0092099', 'https://imdb.com/title/tt0117218', 'https://imdb.com/title/tt0112641', 'https://imdb.com/title/tt0118884', 'https://imdb.com/title/tt0110932', 'https://imdb.com/title/tt0381061', 'https://imdb.com/title/tt0440963', 'https://imdb.com/title/tt0111070', 'https://imdb.com/title/tt0457430', 'https://imdb.com/title/tt0106697', 'https://imdb.com/title/tt0416449', 'https://imdb.com/title/tt0120201', 'https://imdb.com/title/tt0099487', 'https://imdb.com/title/tt0113862', 'https://imdb.com/title/tt0120655', 'https://imdb.com/title/tt0242653', 'https://imdb.com/title/tt0061722', 'https://imdb.com/title/tt0316654', 'https://imdb.com/title/tt0120630', 'https://imdb.com/title/tt0121766', 'https://imdb.com/title/tt0029583', 'https://imdb.com/title/tt0449059', 'https://imdb.com/title/tt0108550', 'https://imdb.com/title/tt0119174', 'https://imdb.com/title/tt0119094', 'https://imdb.com/title/tt0365748', 'https://imdb.com/title/tt0120755', 'https://imdb.com/title/tt0113627', 'https://imdb.com/title/tt0086879', 'https://imdb.com/title/tt0290334', 'https://imdb.com/title/tt0106673', 'https://imdb.com/title/tt0158983', 'https://imdb.com/title/tt1345836', 'https://imdb.com/title/tt1119646', 'https://imdb.com/title/tt0146882', 'https://imdb.com/title/tt0372183', 'https://imdb.com/title/tt0093409', 'https://imdb.com/title/tt0317248', 'https://imdb.com/title/tt0177789', 'https://imdb.com/title/tt0130827', 'https://imdb.com/title/tt0335266', 'https://imdb.com/title/tt0405422', 'https://imdb.com/title/tt0110478', 'https://imdb.com/title/tt0119528', 'https://imdb.com/title/tt0217869', 'https://imdb.com/title/tt0816692', 'https://imdb.com/title/tt0383574', 'https://imdb.com/title/tt0160127', 'https://imdb.com/title/tt0382932', 'https://imdb.com/title/tt0060196', 'https://imdb.com/title/tt0058331', 'https://imdb.com/title/tt0315327', 'https://imdb.com/title/tt0095159', 'https://imdb.com/title/tt1853728', 'https://imdb.com/title/tt1010048', 'https://imdb.com/title/tt0330373', 'https://imdb.com/title/tt0181865', 'https://imdb.com/title/tt0117571', 'https://imdb.com/title/tt0107206', 'https://imdb.com/title/tt0093870', 'https://imdb.com/title/tt0195685', 'https://imdb.com/title/tt0109707', 'https://imdb.com/title/tt0112346', 'https://imdb.com/title/tt0319061', 'https://imdb.com/title/tt0848228', 'https://imdb.com/title/tt0072431', 'https://imdb.com/title/tt0107977', 'https://imdb.com/title/tt0033467', 'https://imdb.com/title/tt0099423', 'https://imdb.com/title/tt0265666', 'https://imdb.com/title/tt0110322', 'https://imdb.com/title/tt0114148', 'https://imdb.com/title/tt0077631', 'https://imdb.com/title/tt0187393', 'https://imdb.com/title/tt0097523', 'https://imdb.com/title/tt0086250', 'https://imdb.com/title/tt0120660', 'https://imdb.com/title/tt0119567', 'https://imdb.com/title/tt0112818', 'https://imdb.com/title/tt0097757', 'https://imdb.com/title/tt1130884', 'https://imdb.com/title/tt0120735', 'https://imdb.com/title/tt0114388', 'https://imdb.com/title/tt0332379', 'https://imdb.com/title/tt0088258', 'https://imdb.com/title/tt0112851', 'https://imdb.com/title/tt0107818', 'https://imdb.com/title/tt0108358', 'https://imdb.com/title/tt0243155', 'https://imdb.com/title/tt0094226', 'https://imdb.com/title/tt0443453', 'https://imdb.com/title/tt0467406', 'https://imdb.com/title/tt0108399', 'https://imdb.com/title/tt0295178', 'https://imdb.com/title/tt1136608', 'https://imdb.com/title/tt0116136', 'https://imdb.com/title/tt0206634', 'https://imdb.com/title/tt0059742', 'https://imdb.com/title/tt0250494', 'https://imdb.com/title/tt0109506', 'https://imdb.com/title/tt0477348', 'https://imdb.com/title/tt0212346', 'https://imdb.com/title/tt0185937', 'https://imdb.com/title/tt0070735', 'https://imdb.com/title/tt0116213', 'https://imdb.com/title/tt0075148', 'https://imdb.com/title/tt0091763', 'https://imdb.com/title/tt0286106', 'https://imdb.com/title/tt0073629', 'https://imdb.com/title/tt0106598', 'https://imdb.com/title/tt0480249', 'https://imdb.com/title/tt0096754', 'https://imdb.com/title/tt0112642', 'https://imdb.com/title/tt0064115', 'https://imdb.com/title/tt0325710', 'https://imdb.com/title/tt0071230', 'https://imdb.com/title/tt0077975', 'https://imdb.com/title/tt0113492', 'https://imdb.com/title/tt0363771', 'https://imdb.com/title/tt0162661', 'https://imdb.com/title/tt0084726', 'https://imdb.com/title/tt0343818', 'https://imdb.com/title/tt0187078', 'https://imdb.com/title/tt0108333', 'https://imdb.com/title/tt0107822', 'https://imdb.com/title/tt0367594', 'https://imdb.com/title/tt0093773', 'https://imdb.com/title/tt0078346', 'https://imdb.com/title/tt0120912', 'https://imdb.com/title/tt0120789', 'https://imdb.com/title/tt0425112', 'https://imdb.com/title/tt0105793', 'https://imdb.com/title/tt0107144', 'https://imdb.com/title/tt0032910', 'https://imdb.com/title/tt0103776', 'https://imdb.com/title/tt0120746', 'https://imdb.com/title/tt0259446', 'https://imdb.com/title/tt0052357', 'https://imdb.com/title/tt0075860', 'https://imdb.com/title/tt0104952', 'https://imdb.com/title/tt0094012', 'https://imdb.com/title/tt0118880', 'https://imdb.com/title/tt0109254', 'https://imdb.com/title/tt0088846', 'https://imdb.com/title/tt0119229', 'https://imdb.com/title/tt0317740', 'https://imdb.com/title/tt0314331', 'https://imdb.com/title/tt2015381', 'https://imdb.com/title/tt0356910', 'https://imdb.com/title/tt0071315', 'https://imdb.com/title/tt0796366', 'https://imdb.com/title/tt0144084', 'https://imdb.com/title/tt0120611', 'https://imdb.com/title/tt0038650', 'https://imdb.com/title/tt0396269', 'https://imdb.com/title/tt0056592', 'https://imdb.com/title/tt0075686', 'https://imdb.com/title/tt0417741', 'https://imdb.com/title/tt0117979', 'https://imdb.com/title/tt1504320', 'https://imdb.com/title/tt0310793', 'https://imdb.com/title/tt0289043', 'https://imdb.com/title/tt0110622', 'https://imdb.com/title/tt0118571', 'https://imdb.com/title/tt0093822', 'https://imdb.com/title/tt0988045', 'https://imdb.com/title/tt0373889', 'https://imdb.com/title/tt1285016', 'https://imdb.com/title/tt0061512', 'https://imdb.com/title/tt0104257', 'https://imdb.com/title/tt0090555', 'https://imdb.com/title/tt0089218', 'https://imdb.com/title/tt0112715', 'https://imdb.com/title/tt0053125', 'https://imdb.com/title/tt0357413', 'https://imdb.com/title/tt0050083', 'https://imdb.com/title/tt0109446', 'https://imdb.com/title/tt0449088', 'https://imdb.com/title/tt0097351', 'https://imdb.com/title/tt0125439', 'https://imdb.com/title/tt0119164', 'https://imdb.com/title/tt0120888', 'https://imdb.com/title/tt0212720', 'https://imdb.com/title/tt0126886', 'https://imdb.com/title/tt0063442', 'https://imdb.com/title/tt0108598', 'https://imdb.com/title/tt0128445', 'https://imdb.com/title/tt0085334', 'https://imdb.com/title/tt0435761', 'https://imdb.com/title/tt0230600', 'https://imdb.com/title/tt0048280', 'https://imdb.com/title/tt0203009', 'https://imdb.com/title/tt0217505', 'https://imdb.com/title/tt0109439', 'https://imdb.com/title/tt0116367', 'https://imdb.com/title/tt0829482', 'https://imdb.com/title/tt0196229', 'https://imdb.com/title/tt0113071', 'https://imdb.com/title/tt0114319', 'https://imdb.com/title/tt0115798', 'https://imdb.com/title/tt0993846', 'https://imdb.com/title/tt1392170', 'https://imdb.com/title/tt1431045', 'https://imdb.com/title/tt0207201', 'https://imdb.com/title/tt0441773', 'https://imdb.com/title/tt0088011', 'https://imdb.com/title/tt0147800', 'https://imdb.com/title/tt1156398', 'https://imdb.com/title/tt0120891', 'https://imdb.com/title/tt0892769', 'https://imdb.com/title/tt0120663', 'https://imdb.com/title/tt0113481', 'https://imdb.com/title/tt0070047', 'https://imdb.com/title/tt0117705', 'https://imdb.com/title/tt0058150', 'https://imdb.com/title/tt0450259', 'https://imdb.com/title/tt0061852', 'https://imdb.com/title/tt0032455', 'https://imdb.com/title/tt0107362', 'https://imdb.com/title/tt0099052', 'https://imdb.com/title/tt0102057', 'https://imdb.com/title/tt0218839', 'https://imdb.com/title/tt0376994', 'https://imdb.com/title/tt0109635', 'https://imdb.com/title/tt0113228', 'https://imdb.com/title/tt0080487', 'https://imdb.com/title/tt0175880', 'https://imdb.com/title/tt0478311', 'https://imdb.com/title/tt0119008', 'https://imdb.com/title/tt0118842', 'https://imdb.com/title/tt0405159', 'https://imdb.com/title/tt2278388', 'https://imdb.com/title/tt0327056', 'https://imdb.com/title/tt0118971', 'https://imdb.com/title/tt0221027', 'https://imdb.com/title/tt0112442', 'https://imdb.com/title/tt0088161', 'https://imdb.com/title/tt0139654', 'https://imdb.com/title/tt0166924', 'https://imdb.com/title/tt0106308', 'https://imdb.com/title/tt0053291', 'https://imdb.com/title/tt0265086', 'https://imdb.com/title/tt2084970', 'https://imdb.com/title/tt0175142', 'https://imdb.com/title/tt0375679', 'https://imdb.com/title/tt0114694', 'https://imdb.com/title/tt0407304', 'https://imdb.com/title/tt0319262', 'https://imdb.com/title/tt1074638', 'https://imdb.com/title/tt0128853', 'https://imdb.com/title/tt1201607', 'https://imdb.com/title/tt0379786', 'https://imdb.com/title/tt0084827', 'https://imdb.com/title/tt0390521', 'https://imdb.com/title/tt0382625', 'https://imdb.com/title/tt0088128', 'https://imdb.com/title/tt0113041', 'https://imdb.com/title/tt0257044', 'https://imdb.com/title/tt0116683', 'https://imdb.com/title/tt0133152', 'https://imdb.com/title/tt0112508', 'https://imdb.com/title/tt0299658', 'https://imdb.com/title/tt0134119', 'https://imdb.com/title/tt0081573', 'https://imdb.com/title/tt0047478', 'https://imdb.com/title/tt0113986', 'https://imdb.com/title/tt0395169', 'https://imdb.com/title/tt0119698', 'https://imdb.com/title/tt0333766', 'https://imdb.com/title/tt0112691', 'https://imdb.com/title/tt0118929', 'https://imdb.com/title/tt0332452', 'https://imdb.com/title/tt0142342', 'https://imdb.com/title/tt0091203', 'https://imdb.com/title/tt3659388', 'https://imdb.com/title/tt0119396', 'https://imdb.com/title/tt0155267', 'https://imdb.com/title/tt0117666', 'https://imdb.com/title/tt0103644', 'https://imdb.com/title/tt0122933', 'https://imdb.com/title/tt1392190', 'https://imdb.com/title/tt0343660', 'https://imdb.com/title/tt0103772', 'https://imdb.com/title/tt1228705', 'https://imdb.com/title/tt0362227', 'https://imdb.com/title/tt0115433', 'https://imdb.com/title/tt0045152', 'https://imdb.com/title/tt0116583', 'https://imdb.com/title/tt0241303', 'https://imdb.com/title/tt0138704', 'https://imdb.com/title/tt0926084', 'https://imdb.com/title/tt0097428', 'https://imdb.com/title/tt0097733', 'https://imdb.com/title/tt0084516', 'https://imdb.com/title/tt0298130', 'https://imdb.com/title/tt0090756', 'https://imdb.com/title/tt0086960', 'https://imdb.com/title/tt0268126', 'https://imdb.com/title/tt1205489', 'https://imdb.com/title/tt0104714', 'https://imdb.com/title/tt0462538', 'https://imdb.com/title/tt0120669', 'https://imdb.com/title/tt0066026', 'https://imdb.com/title/tt0113326']
    start_urls = ['http://duresult.in/students/Combine_GradeCard.aspx']

    def parse(self, response):
        for roll_no in range(17312911001, 17312911045):
            self.log(response.xpath('//*[@id="imgCaptcha"]/@src').get()[33: 39])
            yield scrapy.FormRequest(
                'http://duresult.in/students/Combine_GradeCard.aspx',
                formdata={
                    'ddlcollege': '312',
                    'txtrollno': str(roll_no),
                    'txtcaptcha': response.xpath('//*[@id="imgCaptcha"]/@src').get()[33: 39],
                    'btnsearch': 'Print+Score+Card',
                    '__VIEWSTATE': response.css('input#__VIEWSTATE::attr(value)').extract_first(),
                    '__EVENTVALIDATION': response.css('input#__EVENTVALIDATION::attr(value)').extract_first(),
                    '__VIEWSTATEGENERATOR': response.css('input#__VIEWSTATEGENERATOR::attr(value)').extract_first(),
                    '__EVENTTARGET': '',	
                    '__EVENTARGUMENT': ''	
                },
                callback=self.parse_page,
                meta={'txtrollno': str(roll_no)}
            )
    def parse_page(self, response):
        self.log('here')
        with open('results_combined.csv', 'a+') as myfile:
            wr = csv.writer(myfile, quoting=csv.QUOTE_ALL)
            new_list = []
            item = response.meta.get('txtrollno')
            new_list.append(item)
            new_list.append(response.xpath('//table[@id="gvrslt"]//tr[4]//td[2]/text()').get())
            new_list.append(response.xpath('//table[@id="gvrslt"]//tr[3]//td[2]/text()').get())
            new_list.append(response.xpath('//table[@id="gvrslt"]//tr[2]//td[2]/text()').get())
            wr.writerow(new_list)
